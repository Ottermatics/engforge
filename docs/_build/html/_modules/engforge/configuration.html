<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>engforge.configuration &mdash; engforge 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/readthedocs-custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            engforge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/test.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/engforge.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">engforge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">engforge.configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for engforge.configuration</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">attr</span><span class="o">,</span> <span class="nn">attrs</span>

<span class="kn">from</span> <span class="nn">engforge.engforge_attributes</span> <span class="kn">import</span> <span class="n">AttributedBaseMixin</span>
<span class="kn">from</span> <span class="nn">engforge.logging</span> <span class="kn">import</span> <span class="n">LoggingMixin</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">change_all_log_levels</span>
<span class="kn">from</span> <span class="nn">engforge.properties</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">engforge.env_var</span> <span class="kn">import</span> <span class="n">EnvVariable</span>
<span class="kn">import</span> <span class="nn">randomname</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>


<span class="c1"># make a module logger</span>
<div class="viewcode-block" id="ConfigLog">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.ConfigLog.html#engforge.configuration.ConfigLog">[docs]</a>
<span class="k">class</span> <span class="nc">ConfigLog</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="n">log</span> <span class="o">=</span> <span class="n">ConfigLog</span><span class="p">()</span>

<span class="n">conv_nms</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
<span class="n">NAME_ADJ</span> <span class="o">=</span> <span class="n">EnvVariable</span><span class="p">(</span><span class="s1">&#39;FORGE_NAME_ADJ&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="s1">&#39;algorithms&#39;</span><span class="p">,</span><span class="s1">&#39;complexity&#39;</span><span class="p">,</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span><span class="s1">&#39;materials&#39;</span><span class="p">),</span><span class="n">type_conv</span><span class="o">=</span><span class="n">conv_nms</span><span class="p">)</span>
<span class="n">NAME_NOUN</span> <span class="o">=</span> <span class="n">EnvVariable</span><span class="p">(</span><span class="s1">&#39;FORGE_NAME_NOUN&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;chemistry&#39;</span><span class="p">,</span><span class="s1">&#39;astronomy&#39;</span><span class="p">,</span><span class="s1">&#39;linear_algebra&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;coding&#39;</span><span class="p">,</span><span class="s1">&#39;corporate_job&#39;</span><span class="p">,</span><span class="s1">&#39;design&#39;</span><span class="p">,</span><span class="s1">&#39;car_parts&#39;</span><span class="p">,</span><span class="s1">&#39;machine_learning&#39;</span><span class="p">,</span><span class="s1">&#39;physics_units&#39;</span><span class="p">),</span><span class="n">type_conv</span><span class="o">=</span><span class="n">conv_nms</span><span class="p">)</span>
<span class="n">FORGE_DEBUG</span> <span class="o">=</span> <span class="n">EnvVariable</span><span class="p">(</span><span class="s1">&#39;FORGE_LOG_LEVEL&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;chemistry&#39;</span><span class="p">,</span><span class="s1">&#39;astronomy&#39;</span><span class="p">,</span><span class="s1">&#39;linear_algebra&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;coding&#39;</span><span class="p">,</span><span class="s1">&#39;corporate_job&#39;</span><span class="p">,</span><span class="s1">&#39;design&#39;</span><span class="p">,</span><span class="s1">&#39;car_parts&#39;</span><span class="p">,</span><span class="s1">&#39;machine_learning&#39;</span><span class="p">,</span><span class="s1">&#39;physics_units&#39;</span><span class="p">),</span><span class="n">type_conv</span><span class="o">=</span><span class="n">conv_nms</span><span class="p">)</span>

<div class="viewcode-block" id="name_generator">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.name_generator.html#engforge.configuration.name_generator">[docs]</a>
<span class="k">def</span> <span class="nf">name_generator</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a name generator for the instance&quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;-&#39;</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_use_random_name</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span><span class="n">base</span><span class="o">+</span> <span class="n">randomname</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">adj</span><span class="o">=</span><span class="n">NAME_ADJ</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span><span class="n">noun</span><span class="o">=</span><span class="n">NAME_NOUN</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">base</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;generated name: </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="n">PROTECTED_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">,</span><span class="s1">&#39;dataframe&#39;</span><span class="p">,</span><span class="s1">&#39;_anything_changed&#39;</span><span class="p">]</span>

<span class="c1"># Wraps Configuration with a decorator, similar to @attrs.define(**options)</span>
<div class="viewcode-block" id="forge">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.forge.html#engforge.configuration.forge">[docs]</a>
<span class="k">def</span> <span class="nf">forge</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap all Configurations with this decorator with the following behavior</span>
<span class="sd">    1) we use the callback when any property changes</span>
<span class="sd">    2) repr is default</span>
<span class="sd">    3) hash is by object identity&quot;&quot;&quot;</span>

    <span class="c1"># Define defaults and handle conflicts</span>
    <span class="n">dflts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dflts</span><span class="p">:</span>
            <span class="n">dflts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># we can&#39;t import system here since cls might be system, so look for any system subclasses</span>
        <span class="k">if</span> <span class="s2">&quot;System&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuring System: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">acls</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span>
                <span class="n">on_setattr</span><span class="o">=</span><span class="n">property_changed</span><span class="p">,</span>
                <span class="n">field_transformer</span><span class="o">=</span><span class="n">signals_slots_handler</span><span class="p">,</span>
                <span class="o">**</span><span class="n">dflts</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># must be here since can&#39;t inspect till after fields corrected</span>
            <span class="n">acls</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">()</span>  <span class="c1"># custom class compiler</span>
            <span class="n">acls</span><span class="o">.</span><span class="n">validate_class</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">acls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>  <span class="c1"># prevent configuration lookup</span>
                <span class="n">acls</span><span class="o">.</span><span class="n">compile_classes</span><span class="p">()</span>  <span class="c1"># compile subclasses</span>
            <span class="k">return</span> <span class="n">acls</span>

        <span class="c1"># Component/Config Flow</span>
        <span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuring: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">acls</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">on_setattr</span><span class="o">=</span><span class="n">property_changed</span><span class="p">,</span>
            <span class="n">field_transformer</span><span class="o">=</span><span class="n">comp_transform</span><span class="p">,</span>
            <span class="o">**</span><span class="n">dflts</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">FORGE_DEBUG</span><span class="o">.</span><span class="n">in_env</span><span class="p">:</span>
            <span class="n">change_all_log_levels</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="n">acls</span><span class="p">,</span><span class="n">new_log_level</span><span class="o">=</span><span class="n">FORGE_DEBUG</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>        
        <span class="c1"># must be here since can&#39;t inspect till after fields corrected</span>
        <span class="n">acls</span><span class="o">.</span><span class="n">pre_compile</span><span class="p">()</span>  <span class="c1"># custom class compiler</span>
        <span class="n">acls</span><span class="o">.</span><span class="n">validate_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">acls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>  <span class="c1"># prevent configuration lookup</span>
            <span class="n">acls</span><span class="o">.</span><span class="n">compile_classes</span><span class="p">()</span>  <span class="c1"># compile subclasses</span>
        <span class="k">return</span> <span class="n">acls</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">forge</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span>  <span class="s2">&quot;forge_wrapper&quot;</span>

        <span class="k">return</span> <span class="n">f</span></div>



<div class="viewcode-block" id="meta">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.meta.html#engforge.configuration.meta">[docs]</a>
<span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a convienience wrapper to add metadata to attr.ib</span>
<span class="sd">    :param title: a title that gets formatted for column headers</span>
<span class="sd">    :param desc: a description of the property&quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">out</span></div>



<span class="c1"># Class Definition Wrapper Methods</span>
<div class="viewcode-block" id="property_changed">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.property_changed.html#engforge.configuration.property_changed">[docs]</a>
<span class="k">def</span> <span class="nf">property_changed</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a callback for when a property changes, this will set the _anything_changed flag to True, and change value when appropriate&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">engforge.tabulation</span> <span class="kn">import</span> <span class="n">TabulationMixin</span>
    <span class="kn">from</span> <span class="nn">engforge.problem_context</span> <span class="kn">import</span> <span class="n">ProblemExec</span>

    <span class="c1">#TODO: determine when, in an active problem if components change, and update refs accordingly!</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="p">(</span><span class="n">TabulationMixin</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">value</span>
    
    <span class="c1">#Establish Active Session</span>
    <span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ProblemExec</span><span class="o">.</span><span class="n">class_cache</span><span class="p">,</span> <span class="s2">&quot;session&quot;</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">ProblemExec</span><span class="o">.</span><span class="n">class_cache</span><span class="o">.</span><span class="n">session</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">.</span><span class="n">_anything_changed</span><span class="p">:</span>
        <span class="c1"># Bypass Check since we&#39;ve already flagged for an update</span>
        <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;already property changed </span><span class="si">{</span><span class="n">instance</span><span class="si">}{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="c1">#log.info(f&#39;property changed {variable.name} {value}&#39;)</span>

    <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;checking property changed </span><span class="si">{</span><span class="n">instance</span><span class="si">}{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#Check if should be updated</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="c1">#check identity of variable</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">_anything_changed</span> <span class="ow">and</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">cur</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;changing variables: </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_anything_changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">log</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;didnt change variables </span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">| </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">cur</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    
    <span class="c1">#If active session in dynamic mode and the component is dynamic, flag for matrix update</span>
    <span class="c1">#TODO: determine if dynamic matricies affected by this.</span>
    
    <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="o">.</span><span class="n">dynamic_solve</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">.</span><span class="n">is_dynamic</span><span class="p">:</span>
        <span class="c1">#log.info(f&#39;dynamics changed&#39;)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">dynamics_updated</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#flag for update</span>
        
    <span class="k">elif</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1">#log.info(f&#39;static change&#39;)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">dynamics_updated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">value</span></div>



<span class="c1"># Class Definition Wrapper Methods</span>
<div class="viewcode-block" id="signals_slots_handler">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.signals_slots_handler.html#engforge.configuration.signals_slots_handler">[docs]</a>
<span class="k">def</span> <span class="nf">signals_slots_handler</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">signals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solvers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    creates attributes as per the attrs.define field_transformer use case.</span>

<span class="sd">    Customize initalization with slots,signals,solvers and sys flags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">engforge.problem_context</span> <span class="kn">import</span> <span class="n">ProblemExec</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;transforming signals and slots for </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">PROTECTED_NAMES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot use </span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as a field name, its protected&quot;</span><span class="p">)</span>        
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has no type&quot;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fields: </span><span class="si">{</span><span class="n">field_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#Add Fields (no underscored fields)</span>
    <span class="n">in_fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">in_fields</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">in_fields</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not have a name!&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">name_generator</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
            <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">repr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">eq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">eq_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">order_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">inherited</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">on_setattr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Add Slots</span>
    <span class="k">if</span> <span class="n">slots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">slot_name</span><span class="p">,</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">slots_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">slot_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

    <span class="c1"># Add Signals</span>
    <span class="k">if</span> <span class="n">signals</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">signal</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">signals_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">signal_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

    <span class="c1"># Add SOLVERS</span>
    <span class="k">if</span> <span class="n">solvers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">solver</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">solvers_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

        <span class="c1"># Add Time</span>
        <span class="k">for</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">solver</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">transients_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># add from cls since not accessible from attrs</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pltname</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">plot_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">pltname</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pltname</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">trace_attributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">make_attribute</span><span class="p">(</span><span class="n">pltname</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

    <span class="n">created_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out</span><span class="p">])</span>

    <span class="c1"># Merge Fields Checking if we are overriding an attribute with system_property</span>
    <span class="c1"># hack since TabulationMixin isn&#39;t available yet</span>
    <span class="k">if</span> <span class="s2">&quot;TabulationMixin&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()):</span>
        <span class="n">cls_properties</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">system_properties_classdef</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cls_properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cls_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">__anony_store</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># print(f&#39;tab found!! {cls_properties.keys()}&#39;)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">in_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">created_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cls_properties</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">inherited</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> overriding inherited attr: </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as a system property overriding it&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">inherited</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cls_dict</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> overriding inherited attr: </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">cls_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2"> in cls&quot;</span>
                <span class="p">)</span>
                <span class="c1">#FIXME: should we deepcopy?</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">__anony_store</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sscb</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cls_dict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">sscb</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> adding attr: </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> skipping inherited attr: </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as a custom type overriding it&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Enforce Property Changing</span>
    <span class="c1"># FIXME: is this more reliable than a class wide callback?</span>
    <span class="c1"># real_out = []</span>
    <span class="c1"># for fld in out:</span>
    <span class="c1">#     if fld.type in (int,float,str):</span>
    <span class="c1">#         #log.warning(f&quot;setting property changed on {fld}&quot;)</span>
    <span class="c1">#         fld = fld.evolve(on_setattr = property_changed)</span>
    <span class="c1">#         real_out.append(fld)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         real_out.append(fld)</span>
    <span class="c1"># #return real_out</span>
    <span class="k">return</span> <span class="n">out</span></div>



<span class="c1"># alternate initalisers</span>
<span class="n">comp_transform</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">signals_slots_handler</span><span class="p">(</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">signals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solvers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>



<span class="c1"># TODO: Make A MetaClass for Configuration, and provide forge interface there. Problem with replaceing metaclass later, as in the case of a singleton.</span>
<div class="viewcode-block" id="Configuration">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration">[docs]</a>
<span class="nd">@forge</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">AttributedBaseMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration is a pattern for storing attributes that might change frequently, and proivdes the core functionality for a host of different applications.</span>

<span class="sd">    Configuration is able to go through itself and its objects and map all included Configurations, just to a specific level.</span>

<span class="sd">    Common functionality includes an __on_init__ wrapper for attrs post-init method</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_temp_vars</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_use_random_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">name_generator</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log_fmt</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%(name)-24s</span><span class="s2">]</span><span class="si">%(message)s</span><span class="s2">&quot;</span>
    <span class="n">log_silo</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_created_datetime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_subclass_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Configuration Information</span>
<div class="viewcode-block" id="Configuration.internal_configurations">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.internal_configurations">[docs]</a>
    <span class="k">def</span> <span class="nf">internal_configurations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_config</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">none_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;go through all attributes determining which are configuration objects</span>
<span class="sd">        additionally this skip any configuration that start with an underscore (private variable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">engforge.configuration</span> <span class="kn">import</span> <span class="n">Configuration</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots_attributes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">check_config</span><span class="p">:</span>
            <span class="n">chk</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Configuration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chk</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">slots</span> <span class="ow">and</span> <span class="p">(</span><span class="n">none_ok</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_dict</span><span class="p">:</span>  <span class="c1"># slots</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">chk</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="Configuration.copy_config_at_state">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.copy_config_at_state">[docs]</a>
    <span class="k">def</span> <span class="nf">copy_config_at_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels_deep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">changed</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;copy the system at the current state recrusively to a certain level, by default copying everything</span>
<span class="sd">        :param levels_deep: how many levels deep to copy, -1 is all</span>
<span class="sd">        :param level: the current level, defaults to 0 if not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">engforge.configuration</span> <span class="kn">import</span> <span class="n">Configuration</span>
        <span class="kn">from</span> <span class="nn">engforge.components</span> <span class="kn">import</span> <span class="n">SolveableInterface</span>

        <span class="k">if</span> <span class="n">changed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># top!</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;already changed </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">changed</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># at top level add parent to changed to prevent infinte parent recursion</span>
            <span class="n">changed</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># exit early if below the level</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="n">levels_deep</span> <span class="ow">and</span> <span class="n">levels_deep</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;below level </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">levels_deep</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">new_sys</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy as is</span>
            <span class="n">changed</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_sys</span>
            <span class="k">return</span> <span class="n">new_sys</span>

        <span class="c1"># copy the internal configurations</span>
        <span class="n">kwcomps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_configurations</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copying </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">changed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># copy the system</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">ccomp</span> <span class="o">=</span> <span class="n">changed</span><span class="p">[</span><span class="n">config</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ccomp</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">copy_config_at_state</span><span class="p">(</span>
                    <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levels_deep</span><span class="p">,</span> <span class="n">changed</span>
                <span class="p">)</span>
            <span class="n">kwcomps</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccomp</span>

        <span class="c1"># Finally make the new system with changed internals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;changing with changes </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">kwcomps</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">kw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">new_sys</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwcomps</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">changed</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_sys</span> 

        <span class="c1">#Finally change references!</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_sys</span><span class="p">,</span> <span class="n">SolveableInterface</span><span class="p">):</span>
            <span class="n">new_sys</span><span class="o">.</span><span class="n">system_references</span><span class="p">(</span><span class="n">recache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#update the parents</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;parent&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">new_sys</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">changed</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">new_sys</span></div>


<div class="viewcode-block" id="Configuration.go_through_configurations">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.go_through_configurations">[docs]</a>
    <span class="k">def</span> <span class="nf">go_through_configurations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">levels_to_descend</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">parent_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">only_inst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A generator that will go through all internal configurations up to a certain level</span>
<span class="sd">        if levels_to_descend is less than 0 ie(-1) it will go down, if it 0, None, or False it will</span>
<span class="sd">        only go through this configuration</span>

<span class="sd">        :return: level,config&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">engforge.configuration</span> <span class="kn">import</span> <span class="n">Configuration</span>

        <span class="n">should_yield_level</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">level</span><span class="p">:</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">level</span> <span class="o">&gt;=</span> <span class="n">parent_level</span><span class="p">,</span>
                <span class="nb">any</span><span class="p">([</span><span class="n">levels_to_descend</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="n">levels_to_descend</span><span class="p">]),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">should_yield_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">yield</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="bp">self</span>

        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s2">&quot;check_config&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;check_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_configurations</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">Configuration</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">skey</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">iconf</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">go_through_configurations</span><span class="p">(</span>
                    <span class="n">level</span><span class="p">,</span> <span class="n">levels_to_descend</span><span class="p">,</span> <span class="n">parent_level</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_inst</span> <span class="ow">or</span> <span class="n">iconf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">skey</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">skey</span> <span class="k">else</span> <span class="n">key</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">iconf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">only_inst</span> <span class="ow">or</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                    <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">config</span></div>


    <span class="c1"># Our Special Init Methodology</span>
    <span class="k">def</span> <span class="nf">__on_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this when creating your special init functionality, you must use attrs for input variables, this is called after parents are assigned. subclasses are always called after&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__pre_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this when creating your special init functionality, you must use attrs for input variables, this is called before parents are assigned&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__attrs_post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is called after __init__ by attr&#39;s functionality, we expose __oninit__ for you to use!&quot;&quot;&quot;</span>
        <span class="c1"># Store abs path On Creation, in case we change</span>

        <span class="kn">from</span> <span class="nn">engforge.components</span> <span class="kn">import</span> <span class="n">Component</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anything_changed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># save by default first go!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="c1"># subclass instance instance init causes conflicts in structures ect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pre_init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subclass_init</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s2">&quot;__pre_init__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">comp</span><span class="o">.</span><span class="n">__pre_init__</span> <span class="o">!=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">__pre_init__</span><span class="p">:</span>
                        <span class="n">comp</span><span class="o">.</span><span class="n">__pre_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;error in __pre_init__ </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Assign Parents, ensure single componsition</span>
        <span class="c1">#TODO: allow multi-parent, w/wo keeping state, state swap on update()?</span>
        <span class="c1">#TODO: replace parent concept with problem context</span>
        <span class="k">for</span> <span class="n">compnm</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_configurations</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">Component</span><span class="p">):</span>
                <span class="c1"># TODO: allow multiple parents</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Component </span><span class="si">{</span><span class="n">compnm</span><span class="si">}</span><span class="s2"> already has a parent </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2"> copying, and assigning to </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compnm</span><span class="p">,</span> <span class="n">attrs</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">comp</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;created </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># subclass instance instance init causes conflicts in structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__on_init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subclass_init</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s2">&quot;__on_init__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">comp</span><span class="o">.</span><span class="n">__on_init__</span> <span class="o">!=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">__on_init__</span><span class="p">:</span>
                        <span class="n">comp</span><span class="o">.</span><span class="n">__on_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;error in __on_init__&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Configuration.validate_class">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.validate_class">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A customizeable validator at the end of class creation in forge&quot;&quot;&quot;</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Configuration.pre_compile">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.pre_compile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pre_compile</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;an overrideable classmethod that executes when compiled, however will not execute as a subclass&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Configuration.compile_classes">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.compile_classes">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compile_classes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compiles all subclass functionality&quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">cls_compile</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">subcls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parent_configurations_cls</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subcls</span><span class="o">.</span><span class="n">subcls_compile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Configuration</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> compiling </span><span class="si">{</span><span class="n">subcls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">subcls</span><span class="o">.</span><span class="n">subcls_compile</span><span class="p">()</span></div>


<div class="viewcode-block" id="Configuration.cls_compile">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.cls_compile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cls_compile</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;compiles this class, override this to compile functionality for this class&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Configuration.subcls_compile">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.subcls_compile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">subcls_compile</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;reliably compiles this method even for subclasses, override this to compile functionality for subclass interfaces &amp; mixins&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Configuration.parent_configurations_cls">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.parent_configurations_cls">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parent_configurations_cls</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns all subclasses that are a Configuration&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span> <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Configuration</span><span class="p">)]</span></div>


    <span class="c1"># Identity &amp; location Methods</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A nice to have, good to override&quot;&quot;&quot;</span>
        <span class="n">fil</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">c</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fil</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span>
            <span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">displayname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># dispname = &quot;&quot;.join([c for c in dn if c.isalpha() or c.isdigit() or c==&#39;_&#39; or c==&#39;-&#39;]).rstrip()</span>
        <span class="k">return</span> <span class="n">dn</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A customizeable property that will be in the log by default&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classname</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shorthand for the classname&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Structural Orchestration Through Subclassing</span>
<div class="viewcode-block" id="Configuration.subclasses">
<a class="viewcode-back" href="../../_autosummary/engforge.configuration.Configuration.html#engforge.configuration.Configuration.subclasses">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return all subclasses of components, including their subclasses</span>
<span class="sd">        :param out: out is to pass when the middle of a recursive operation, do not use it!</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># init the set by default</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
            <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">subclasses</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin Russell.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>