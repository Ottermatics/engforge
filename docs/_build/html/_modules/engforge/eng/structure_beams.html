<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>engforge.eng.structure_beams &mdash; engforge 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/readthedocs-custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            engforge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/test.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/engforge.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">engforge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">engforge.eng.structure_beams</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for engforge.eng.structure_beams</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Point</span>

<span class="kn">from</span> <span class="nn">engforge.tabulation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TABLE_TYPES</span><span class="p">,</span>
    <span class="n">NUMERIC_VALIDATOR</span><span class="p">,</span>
    <span class="n">system_property</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">engforge.configuration</span> <span class="kn">import</span> <span class="n">forge</span><span class="p">,</span> <span class="n">Configuration</span>
<span class="kn">from</span> <span class="nn">engforge.components</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="c1"># from engforge.analysis import Analysis</span>
<span class="kn">from</span> <span class="nn">engforge.properties</span> <span class="kn">import</span> <span class="n">system_property</span>
<span class="kn">from</span> <span class="nn">engforge.system</span> <span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span> <span class="nn">engforge.eng.solid_materials</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">engforge.common</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">engforge.eng.geometry</span> <span class="k">as</span> <span class="nn">ottgeo</span>
<span class="kn">from</span> <span class="nn">engforge.eng.costs</span> <span class="kn">import</span> <span class="n">CostModel</span><span class="p">,</span><span class="n">cost_property</span>

<span class="kn">import</span> <span class="nn">sectionproperties</span>
<span class="kn">import</span> <span class="nn">sectionproperties.pre.geometry</span> <span class="k">as</span> <span class="nn">geometry</span>
<span class="kn">import</span> <span class="nn">sectionproperties.pre.library.primitive_sections</span> <span class="k">as</span> <span class="nn">sections</span>
<span class="kn">import</span> <span class="nn">sectionproperties.analysis.section</span> <span class="k">as</span> <span class="nn">cross_section</span>
<span class="kn">import</span> <span class="nn">PyNite</span> <span class="k">as</span> <span class="nn">pynite</span>

<span class="c1"># from PyNite import Visualization</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="n">nonetype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>


<div class="viewcode-block" id="rotation_matrix_from_vectors">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.rotation_matrix_from_vectors.html#engforge.eng.structure_beams.rotation_matrix_from_vectors">[docs]</a>
<span class="k">def</span> <span class="nf">rotation_matrix_from_vectors</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the rotation matrix that aligns vec1 to vec2</span>
<span class="sd">    :param vec1: A 3d &quot;source&quot; vector</span>
<span class="sd">    :param vec2: A 3d &quot;destination&quot; vector</span>
<span class="sd">    :return mat: A transform matrix (3x3) which when applied to vec1, aligns it with vec2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">vec1</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span>
        <span class="n">vec2</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>  <span class="c1"># if not all zeros then</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">kmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">kmat</span> <span class="o">+</span> <span class="n">kmat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">kmat</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span>
            <span class="mi">3</span>
        <span class="p">)</span>  <span class="c1"># cross of all zeros only occurs on identical directions</span></div>



<div class="viewcode-block" id="Beam">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam">[docs]</a>
<span class="nd">@forge</span>
<span class="k">class</span> <span class="nc">Beam</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span><span class="n">CostModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Beam is a wrapper for emergent useful properties of the structure&quot;&quot;&quot;</span>

    <span class="c1"># parent structure, will be in its _beams</span>
    <span class="n">structure</span><span class="p">:</span> <span class="s2">&quot;Structure&quot;</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>
    <span class="n">material</span><span class="p">:</span> <span class="s2">&quot;SolidMaterial&quot;</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="n">SolidMaterial</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">section</span><span class="p">:</span> <span class="s2">&quot;Profile2D&quot;</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">Geometry</span><span class="p">,</span>
                <span class="n">ottgeo</span><span class="o">.</span><span class="n">Profile2D</span><span class="p">,</span>
                <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Section Overrides</span>
    <span class="n">in_Iy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonetype</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">in_Ix</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonetype</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">in_J</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonetype</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">in_A</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonetype</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="c1"># by default assume symmetric</span>
    <span class="n">in_Ixy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonetype</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">min_mesh_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">analysis_intervals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">_L</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_ITensor</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">min_stress_xy</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># set to true or false</span>

    <span class="k">def</span> <span class="nf">__on_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;initalizing...&quot;</span><span class="p">)</span>
        <span class="c1"># update material</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">ShapelySection</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No Section Material&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">section</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;determining </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> properties...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;converting to shapelysection </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">material</span><span class="p">:</span>
                <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">material</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">ShapelySection</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">ShapelySection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;determining profile </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> properties...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Ixx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Iyy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">J</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">A</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_Ixy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Ixy</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">Profile2D</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;use shapely section instead </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> properties...&quot;</span><span class="p">)</span>
            <span class="c1">#raise Exception(&quot;use shapely section instead&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Ixx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Iyy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">J</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unhanelded input </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;checking input values&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_J</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Assemble tensor</span>
        <span class="n">T</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Ixy</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_Ixy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ITensor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">current_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">L</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">member</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">members</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">i_node</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">j_node</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">P1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">.</span><span class="n">Z</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">P2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="o">.</span><span class="n">Z</span><span class="p">])</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">E</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">E</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">G</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ITensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ITensor</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Iy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Ix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_J</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ao</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;outside area, over ride for hallow sections&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">Profile2D</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">Ao</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Ixy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Imx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ix</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Imy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Iy</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Imxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ixy</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Jm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Imz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">12.0</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Iz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outside area inertia on z&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">12.0</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Izo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Outside area inertia on z&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ao</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">12.0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LOCAL_INERTIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the mass inertia tensor in local frame&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Imz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imxy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Imxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Jm</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">INERTIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the mass inertia tensor in global structure frame&quot;&quot;&quot;</span>
        <span class="c1"># TODO: include rotation from beam uv vector frame? is it ok already?</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LOCAL_INERTIA</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">GLOBAL_INERTIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the rotated inertia matrix with structure relative parallal axis contribution&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INERTIA</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CG_RELATIVE_INERTIA</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">CG_RELATIVE_INERTIA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the mass inertia tensor in global frame&quot;&quot;&quot;</span>
        <span class="n">dcg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cog</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">dcg</span> <span class="o">*</span> <span class="n">dcg</span><span class="o">.</span><span class="n">T</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Vol</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Vol_outside</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ao</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">section_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vol</span>

    <span class="nd">@cost_property</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;mfg,material,beams&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">cost_per_kg</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">centroid2d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">_sec</span><span class="o">.</span><span class="n">get_c</span><span class="p">()</span>

    <span class="nd">@instance_cached</span>
    <span class="k">def</span> <span class="nf">centroid3d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_vec</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_vec</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid3d</span>

    <span class="c1"># Geometry Tabulation</span>
    <span class="c1"># p1</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">X1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Y1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Z1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># p2</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">X2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Y2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Z2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># cg</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Xcg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Ycg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid3d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">Zcg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid3d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">RotationMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n_o</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># n_vec is along Z, so we must tranlate from the along axis which is z</span>
        <span class="k">return</span> <span class="n">rotation_matrix_from_vectors</span><span class="p">(</span><span class="n">n_o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_vec</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ReverseRotationMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME: Ensure that this is the correct orientation</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RotationMatrix</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">section_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">_sec</span><span class="o">.</span><span class="n">display_results</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">_sec</span><span class="o">.</span><span class="n">plot_mesh</span><span class="p">()</span>

<div class="viewcode-block" id="Beam.estimate_stress">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.estimate_stress">[docs]</a>
    <span class="k">def</span> <span class="nf">estimate_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_calc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">forces</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;uses the best available method to determine max stress in the beam, for ShapelySections this is done through a learning process, for other sections it is done through a simple calculation aimed at providing a conservative estimate&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">ottgeo</span><span class="o">.</span><span class="n">ShapelySection</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">estimate_stress</span><span class="p">(</span><span class="o">**</span><span class="n">forces</span><span class="p">,</span><span class="n">force_calc</span><span class="o">=</span><span class="n">force_calc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_estimate_stress</span><span class="p">(</span><span class="o">**</span><span class="n">forces</span><span class="p">)</span></div>

        
    <span class="k">def</span> <span class="nf">_fallback_estimate_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">mxx</span><span class="p">,</span> <span class="n">myy</span><span class="p">,</span> <span class="n">mzz</span><span class="p">,</span><span class="n">SM</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">**</span><span class="n">extra</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;sum the absolute value of each stress component. This isn&#39;t accurate but each value here should represent the worst sections, and take the 1-norm to max for each type of stress&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">x_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bad section bounds&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">calculate_bounds</span><span class="p">()</span>

        <span class="n">m_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">y_bounds</span><span class="p">])</span>
        <span class="n">m_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">x_bounds</span><span class="p">])</span>

        <span class="n">sigma_n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span>

        <span class="n">sigma_bx</span> <span class="o">=</span> <span class="n">mxx</span> <span class="o">*</span> <span class="n">m_y</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Ix</span>
        <span class="n">sigma_by</span> <span class="o">=</span> <span class="n">myy</span> <span class="o">*</span> <span class="n">m_x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_Iy</span>
        <span class="n">sigma_tw</span> <span class="o">=</span> <span class="n">mzz</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_x</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_J</span>

        <span class="c1"># A2 = self.in_A/2.</span>
        <span class="c1"># experimental</span>
        <span class="c1"># sigma_vx = vx * (A2*m_y/2) / (self.in_Iy*m_x)</span>
        <span class="c1"># sigma_vy = vy * (A2*m_x/2) / (self.in_Ix*m_y)</span>

        <span class="c1"># assume circle (worst case)</span>
        <span class="n">sigma_vx</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">*</span> <span class="mf">0.75</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span>
        <span class="n">sigma_vy</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">*</span> <span class="mf">0.75</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_A</span>

        <span class="n">max_bend</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sigma_bx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sigma_by</span><span class="p">)</span>
        <span class="n">max_shear</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sigma_vx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sigma_vy</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sigma_n</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_bend</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sigma_tw</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_shear</span><span class="p">)</span><span class="o">*</span><span class="n">SM</span>

<div class="viewcode-block" id="Beam.get_forces_at">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.get_forces_at">[docs]</a>
    <span class="k">def</span> <span class="nf">get_forces_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lower</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip_principle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;outputs pynite results in section_properties.calculate_stress() input&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">combo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>  <span class="c1"># frac of L</span>
        <span class="n">principles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m11&#39;</span><span class="p">,</span><span class="s1">&#39;m22&#39;</span><span class="p">,</span><span class="s1">&#39;m33&#39;</span><span class="p">]</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">axial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
            <span class="n">Vx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">shear</span><span class="p">(</span><span class="s2">&quot;Fz&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
            <span class="n">Vy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">shear</span><span class="p">(</span><span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
            <span class="n">Mxx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="s2">&quot;Mz&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
            <span class="n">Myy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
            <span class="n">M11</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">M22</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">Mzz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">torque</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inp</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">principles</span><span class="p">])</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">skip_principle</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">inp</span></div>


<div class="viewcode-block" id="Beam.get_stress_at">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.get_stress_at">[docs]</a>
    <span class="k">def</span> <span class="nf">get_stress_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;takes force input and runs stress calculation as a fraction of material properties&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">combo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_forces_at</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">combo</span><span class="p">)</span>
        
        <span class="c1">#preferr real stresses to fail fraction</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stress</span><span class="p">(</span><span class="o">**</span><span class="n">inp</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="Beam.calculate_stress">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.calculate_stress">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">forces</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;takes force input and runs stress calculation as a fraction of material properties, see ShapelySection.calculate_stress() for more details&quot;&quot;&quot;</span>
        <span class="c1">#preferr real stresses to fail fraction</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
            <span class="n">forces</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>        
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">calculate_stress</span><span class="p">(</span><span class="o">**</span><span class="n">forces</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Fg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;force of gravity&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">g</span><span class="p">])</span>

    <span class="c1"># RESULTS:</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_stress_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;estimates these are proportional to stress but 2D FEA is &quot;truth&quot; since we lack cross section specifics&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_stress</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_forces_at</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;failed to get max stress estimate </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">| </span><span class="si">{</span><span class="n">vals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">fail_factor_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the ratio of max estimated stress to the material&#39;s allowable stress&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>              
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stress_estimate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">allowable_stress</span>

    <span class="c1"># axial</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_axial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_axial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_axial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_axial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="c1"># deflection</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_deflection_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_deflection</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_deflection_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_deflection</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_deflection_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_deflection</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_deflection_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_deflection</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="c1"># torsion</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_torsion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_torque</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_torsion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_torque</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="c1"># shear</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_shear_z</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_shear</span><span class="p">(</span><span class="s2">&quot;Fz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_shear_z</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_shear</span><span class="p">(</span><span class="s2">&quot;Fz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_shear_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_shear</span><span class="p">(</span><span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_shear_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_shear</span><span class="p">(</span><span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="c1"># moment</span>
    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_moment_z</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_moment</span><span class="p">(</span><span class="s2">&quot;Mz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_moment_z</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_moment</span><span class="p">(</span><span class="s2">&quot;Mz&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">min_moment_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">min_moment</span><span class="p">(</span><span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="nd">@system_property</span>
    <span class="k">def</span> <span class="nf">max_moment_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_any_solved</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">max_moment</span><span class="p">(</span><span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">current_combo</span><span class="p">)</span>

    <span class="c1"># Load Application</span>
    <span class="k">def</span> <span class="nf">get_valid_force_choices</span><span class="p">(</span>
        <span class="n">only_local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_global</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_moment</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">only_local</span> <span class="ow">or</span> <span class="n">only_global</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">only_global</span> <span class="o">!=</span> <span class="n">only_local</span><span class="p">,</span> <span class="s2">&quot;choose local or global&quot;</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Fz&quot;</span><span class="p">])</span>
        <span class="n">fglb</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;FX&quot;</span><span class="p">,</span> <span class="s2">&quot;FY&quot;</span><span class="p">,</span> <span class="s2">&quot;FZ&quot;</span><span class="p">])</span>
        <span class="n">mloc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;Mx&quot;</span><span class="p">,</span> <span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="s2">&quot;Mz&quot;</span><span class="p">])</span>
        <span class="n">mglb</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;MX&quot;</span><span class="p">,</span> <span class="s2">&quot;MY&quot;</span><span class="p">,</span> <span class="s2">&quot;MZ&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">only_global</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_moment</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">fglb</span><span class="p">,</span> <span class="n">mglb</span><span class="p">)))</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">fglb</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">only_local</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_moment</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">floc</span><span class="p">,</span> <span class="n">mloc</span><span class="p">)))</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">floc</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_moment</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">floc</span><span class="p">,</span> <span class="n">mloc</span><span class="p">,</span> <span class="n">fglb</span><span class="p">,</span> <span class="n">mglb</span><span class="p">)))</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">floc</span><span class="p">,</span> <span class="n">fglb</span><span class="p">)))</span>

    <span class="c1"># FORCE APPLICATION (TODO: update for global input 0.0.78)</span>
<div class="viewcode-block" id="Beam.apply_pt_load">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.apply_pt_load">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_pt_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_frac</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add a force in a global orientation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">default_case</span>

        <span class="c1"># adjust x for relative input</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x_frac</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_force_choices</span><span class="p">(</span><span class="n">use_moment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_global</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Fval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding </span><span class="si">{</span><span class="n">Fkey</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">Fval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">add_member_pt_load</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="n">case</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Beam.apply_distributed_load">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.apply_distributed_load">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_distributed_load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add forces in global vector&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">default_case</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_force_choices</span><span class="p">(</span><span class="n">use_moment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_global</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Fval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding dist </span><span class="si">{</span><span class="n">Fkey</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">Fval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">add_member_dist_load</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">Fkey</span><span class="p">,</span>
                    <span class="n">Fval</span> <span class="o">*</span> <span class="n">start_factor</span><span class="p">,</span>
                    <span class="n">Fval</span> <span class="o">*</span> <span class="n">end_factor</span><span class="p">,</span>
                    <span class="n">case</span><span class="o">=</span><span class="n">case</span><span class="p">,</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Beam.apply_local_pt_load">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.apply_local_pt_load">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_local_pt_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add a force in a global orientation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">default_case</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_force_choices</span><span class="p">(</span><span class="n">only_local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_moment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Fval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding </span><span class="si">{</span><span class="n">Fkey</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">Fval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">add_member_pt_load</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="n">case</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Beam.apply_local_distributed_load">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.apply_local_distributed_load">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_local_distributed_load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add forces in global vector&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">case</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">default_case</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_force_choices</span><span class="p">(</span><span class="n">only_local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_moment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Fkey</span><span class="p">,</span> <span class="n">Fval</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Fval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding dist </span><span class="si">{</span><span class="n">Fkey</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">Fval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">add_member_dist_load</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">Fkey</span><span class="p">,</span>
                    <span class="n">Fval</span> <span class="o">*</span> <span class="n">start_factor</span><span class="p">,</span>
                    <span class="n">Fval</span> <span class="o">*</span> <span class="n">end_factor</span><span class="p">,</span>
                    <span class="n">case</span><span class="o">=</span><span class="n">case</span><span class="p">,</span>
                <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">apply_gravity_force_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ev</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z_dir</span><span class="o">=</span><span class="s2">&quot;FZ&quot;</span><span class="p">,</span> <span class="n">z_mag</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">):</span>
        <span class="c1"># TODO: ensure that integral of sv, ev is 1, and all positive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;applying gravity distribution to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_cases</span><span class="p">:</span>
            <span class="n">total_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_mag</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">z_dir</span><span class="p">:</span> <span class="n">z_mag</span> <span class="o">*</span> <span class="n">total_weight</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_distributed_load</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_name</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_gravity_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">z_dir</span><span class="o">=</span><span class="s2">&quot;FZ&quot;</span><span class="p">,</span> <span class="n">z_mag</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;applying gravity to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_cases</span><span class="p">:</span>
            <span class="n">total_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_mag</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">z_dir</span><span class="p">:</span> <span class="n">z_mag</span> <span class="o">*</span> <span class="n">total_weight</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_pt_load</span><span class="p">(</span><span class="n">x_frac</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">gravity_name</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">Beam</span><span class="p">)))</span>

<div class="viewcode-block" id="Beam.max_von_mises">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.max_von_mises">[docs]</a>
    <span class="k">def</span> <span class="nf">max_von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The worst of the worst cases, after adjusting the beem orientation for best loading&quot;&quot;&quot;</span>
        <span class="c1"># TODO: make faster system property</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">max_von_mises_by_case</span><span class="p">()])</span></div>

    
<div class="viewcode-block" id="Beam.max_von_mises_by_case">
<a class="viewcode-back" href="../../../_autosummary/engforge.eng.structure_beams.Beam.html#engforge.eng.structure_beams.Beam.max_von_mises_by_case">[docs]</a>
    <span class="k">def</span> <span class="nf">max_von_mises_by_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gathers max vonmises stress info per case&quot;&quot;&quot;</span>
    
        <span class="n">cmprv</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">rxy</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises_stress_l</span>
            <span class="k">for</span> <span class="n">cmbo</span><span class="p">,</span> <span class="n">vm_stress_vec</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">combos</span> <span class="ow">and</span> <span class="n">cmbo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vm_stress_vec</span><span class="p">))</span>
            <span class="n">cmprv</span><span class="p">[</span><span class="n">rxy</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">cmprv</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cmprv</span><span class="p">[</span><span class="kc">False</span><span class="p">]:</span>
            <span class="n">vt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">cmprv</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span>
            <span class="n">vf</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">cmprv</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span>
    
            <span class="c1"># We choose the case with the</span>
            <span class="k">if</span> <span class="n">vf</span> <span class="o">&lt;</span> <span class="n">vt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_stress_xy</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="n">vf</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">min_stress_xy</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">vt</span></div>

    
    <span class="c1">#TODO: Breakout other stress vectors</span>
    <span class="nd">@solver_cached</span>
    <span class="k">def</span> <span class="nf">von_mises_stress_l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Max von-mises stress&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sect_stresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_stresses</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">LoadCombos</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_intervals</span><span class="p">):</span>
                <span class="n">max_vm</span> <span class="o">=</span> <span class="n">sect_stresses</span><span class="p">[</span><span class="n">combo</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vm</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">combo</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
    
    
    <span class="k">def</span> <span class="nf">section_stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># FIXME: enable: assert self.structure.solved, f&#39;must be solved first!&#39;</span>
        <span class="n">combos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">LoadCombos</span><span class="p">:</span>
            <span class="n">combos</span><span class="p">[</span><span class="n">combo</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_intervals</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluating stresses for </span><span class="si">{</span><span class="n">combo</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> w </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stress_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span>
        <span class="k">return</span> <span class="n">combos</span>               </div>

        

    <span class="c1"># #TODO: remove or refactor</span>
    <span class="c1"># @solver_cached</span>
    <span class="c1"># def stress_info(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Max profile stress info along beam for each type&quot;&quot;&quot;</span>
    <span class="c1">#     rows = []</span>
    <span class="c1">#     for combo in self.structure.frame.LoadCombos:</span>
    <span class="c1">#         for i in numpy.linspace(0, 1, self.analysis_intervals):</span>
    <span class="c1">#             mat_stresses = self.section_stresses[combo][i].get_stress()</span>
    <span class="c1">#             oout = {&quot;x&quot;: i, &quot;combo&quot;: combo}</span>
    <span class="c1">#             for stresses in mat_stresses:</span>
    <span class="c1">#                 max_vals = {</span>
    <span class="c1">#                     sn</span>
    <span class="c1">#                     + &quot;_max_&quot;</span>
    <span class="c1">#                     + stresses[&quot;Material&quot;]: numpy.nanmax(stress)</span>
    <span class="c1">#                     for sn, stress in stresses.items()</span>
    <span class="c1">#                     if isinstance(stress, numpy.ndarray)</span>
    <span class="c1">#                 }</span>
    <span class="c1">#                 min_vals = {</span>
    <span class="c1">#                     sn</span>
    <span class="c1">#                     + &quot;_min_&quot;</span>
    <span class="c1">#                     + stresses[&quot;Material&quot;]: numpy.nanmin(stress)</span>
    <span class="c1">#                     for sn, stress in stresses.items()</span>
    <span class="c1">#                     if isinstance(stress, numpy.ndarray)</span>
    <span class="c1">#                 }</span>
    <span class="c1">#                 avg_vals = {</span>
    <span class="c1">#                     sn</span>
    <span class="c1">#                     + &quot;_avg_&quot;</span>
    <span class="c1">#                     + stresses[&quot;Material&quot;]: numpy.nanmean(stress)</span>
    <span class="c1">#                     for sn, stress in stresses.items()</span>
    <span class="c1">#                     if isinstance(stress, numpy.ndarray)</span>
    <span class="c1">#                 }</span>
    <span class="c1">#                 # Make some simple to determine dataframe failure prediction</span>
    <span class="c1">#                 factor_of_saftey = (</span>
    <span class="c1">#                     self.material.yield_strength</span>
    <span class="c1">#                     / numpy.nanmax(stresses[&quot;sig_vm&quot;])</span>
    <span class="c1">#                 )</span>
    <span class="c1">#                 fail_frac = (</span>
    <span class="c1">#                     numpy.nanmax(stresses[&quot;sig_vm&quot;])</span>
    <span class="c1">#                     / self.material.allowable_stress</span>
    <span class="c1">#                 )</span>
    <span class="c1">#                 fsnm = stresses[&quot;Material&quot;] + &quot;_saftey_factor&quot;</span>
    <span class="c1">#                 fsff = stresses[&quot;Material&quot;] + &quot;_fail_frac&quot;</span>
    <span class="c1">#                 allowable = {fsnm: factor_of_saftey, fsff: fail_frac}</span>
    <span class="c1">#                 oout.update(allowable)</span>
    <span class="c1">#                 oout.update(max_vals)</span>
    <span class="c1">#                 oout.update(min_vals)</span>
    <span class="c1">#                 oout.update(avg_vals)</span>
    <span class="c1">#             rows.append(oout)</span>
    <span class="c1"># </span>
    <span class="c1">#     return pandas.DataFrame(rows)</span>

 
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin Russell.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>