<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>engforge.reporting &mdash; engforge 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/readthedocs-custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            engforge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/test.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/engforge.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">engforge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">engforge.reporting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for engforge.reporting</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The set of reporters define an interface to report plots or tables&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">engforge.configuration</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">forge</span>
<span class="kn">from</span> <span class="nn">engforge.typing</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">engforge.logging</span> <span class="kn">import</span> <span class="n">LoggingMixin</span>
<span class="kn">import</span> <span class="nn">attrs</span>
<span class="kn">import</span> <span class="nn">abc</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<div class="viewcode-block" id="path_exist_validator">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.path_exist_validator.html#engforge.reporting.path_exist_validator">[docs]</a>
<span class="k">def</span> <span class="nf">path_exist_validator</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> isnt a string&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span></div>



<span class="c1"># BASE CLASSSES (PLOT + TABLE)</span>
<div class="viewcode-block" id="Reporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.Reporter.html#engforge.reporting.Reporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">Reporter</span><span class="p">(</span><span class="n">LoggingMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A mixin intended&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;reporter&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Reporter.check_config">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.Reporter.html#engforge.reporting.Reporter.check_config">[docs]</a>
    <span class="k">def</span> <span class="nf">check_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a test to see if the reporter should be used&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Reporter.subclasses">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.Reporter.html#engforge.reporting.Reporter.subclasses">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get all reporters of this type&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">scls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
            <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">scls</span><span class="p">)</span>
            <span class="n">scls</span><span class="o">.</span><span class="n">subclasses</span><span class="p">(</span><span class="n">scls</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="s2">&quot;Analysis&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;uploading </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">()</span></div>



<span class="c1"># Functionality Mixins</span>
<div class="viewcode-block" id="TemporalReporterMixin">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.TemporalReporterMixin.html#engforge.reporting.TemporalReporterMixin">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">TemporalReporterMixin</span><span class="p">(</span><span class="n">Reporter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide single or periodic keys&quot;&quot;&quot;</span>

    <span class="c1"># report_mode: Options(&quot;single&quot;, &quot;daily&quot;, &quot;monthly&quot;) #choose wisely</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">report_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">month_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">report_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;define your keys!&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">()</span></div>



<div class="viewcode-block" id="DiskReporterMixin">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.DiskReporterMixin.html#engforge.reporting.DiskReporterMixin">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">DiskReporterMixin</span><span class="p">(</span><span class="n">TemporalReporterMixin</span><span class="p">):</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">path_exist_validator</span><span class="p">)</span>

    <span class="c1"># whats our /report/&lt;key&gt; gonna be</span>
    <span class="n">report_mode</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">report_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_mode</span> <span class="o">==</span> <span class="s2">&quot;daily&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_mode</span> <span class="o">==</span> <span class="s2">&quot;monthly&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">month_key</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;options failed!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_root</span><span class="p">):</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_root</span><span class="p">)</span>
            <span class="n">pth</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span><span class="n">is_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">pth</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">diri</span> <span class="o">=</span> <span class="n">pth</span> <span class="k">if</span> <span class="n">is_dir</span> <span class="k">else</span> <span class="n">pth</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diri</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">diri</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<span class="c1"># Basic Reporter Types</span>
<div class="viewcode-block" id="TableReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.TableReporter.html#engforge.reporting.TableReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">TableReporter</span><span class="p">(</span><span class="n">Reporter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A reporter to upload dataframes to a table store&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;table_reporter&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="PlotReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.PlotReporter.html#engforge.reporting.PlotReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">PlotReporter</span><span class="p">(</span><span class="n">Reporter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A reporter to upload plots to a file store&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;plot_reporter&quot;</span><span class="p">)</span>

    <span class="c1"># FIXME: make attrs work... layout class conflict</span>
    <span class="c1"># ext = Options(&#39;png&#39;,&#39;jpg&#39;,&#39;gif&#39;)</span>
    <span class="c1"># ext: str = attrs.field(default=&#39;png&#39;)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>

<span class="c1">#     def upload(self, analysis):</span>
<span class="c1">#         for figkey, fig in analysis.stored_plots.items():</span>
<span class="c1">#             try:</span>
<span class="c1">#                 filname = os.path.join(self.report_root, f&quot;{figkey}.{self.ext}&quot;)</span>
<span class="c1">#                 self.ensure_path(filname)</span>
<span class="c1">#                 self.info(f&quot;saving {figkey} to {filname}&quot;)</span>
<span class="c1">#                 fig.savefig(filname)</span>
<span class="c1"># </span>
<span class="c1">#             except Exception as e:</span>
<span class="c1">#                 self.error(e, f&quot;issue showing {figkey}&quot;)</span>
    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">analyis</span><span class="p">):</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;plot reporter subclass needs an upload method&#39;</span><span class="p">)</span></div>



<span class="c1"># Table Reporters</span>
<div class="viewcode-block" id="CSVReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.CSVReporter.html#engforge.reporting.CSVReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">CSVReporter</span><span class="p">(</span><span class="n">TableReporter</span><span class="p">,</span> <span class="n">DiskReporterMixin</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="s2">&quot;Analysis&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;uploading </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_exists</span><span class="p">()</span>

        <span class="n">system</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">system</span>

        <span class="c1"># Make System Dataframe</span>
        <span class="n">af</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;system_</span><span class="si">{</span><span class="n">system</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_path</span><span class="p">(</span><span class="n">af</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;saving system to: </span><span class="si">{</span><span class="n">af</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">af</span><span class="p">)</span></div>


<span class="c1">#         # Make Analysis Dataframe</span>
<span class="c1">#         af = os.path.join(self.report_root, f&quot;analysis_{analysis.name}.csv&quot;)</span>
<span class="c1">#         self.ensure_path(af)</span>
<span class="c1">#         self.info(f&quot;saving analysis to: {af}&quot;)</span>
<span class="c1">#         analysis.dataframe.to_csv(af)</span>
<span class="c1"># </span>
<span class="c1">#         for ckey, comp in system.comp_references().items():</span>
<span class="c1">#             af = os.path.join(self.report_root, f&quot;{ckey}_{comp.name}.csv&quot;)</span>
<span class="c1">#             self.ensure_path(af)</span>
<span class="c1">#             self.info(f&quot;saving {ckey} to: {af}&quot;)</span>
<span class="c1">#             comp.dataframe.to_csv(af)</span>


<div class="viewcode-block" id="ExcelReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.ExcelReporter.html#engforge.reporting.ExcelReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">ExcelReporter</span><span class="p">(</span><span class="n">TableReporter</span><span class="p">,</span> <span class="n">DiskReporterMixin</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;EXCEL&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="GsheetsReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.GsheetsReporter.html#engforge.reporting.GsheetsReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">GsheetsReporter</span><span class="p">(</span><span class="n">TableReporter</span><span class="p">,</span> <span class="n">TemporalReporterMixin</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;GSHEETS&quot;</span><span class="p">)</span></div>



<span class="c1"># @attrs.define</span>
<span class="c1"># class SQLReporter(TableReporter):</span>
<span class="c1">#     name: str = attrs.field(default=&quot;SQL&quot;)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># @attrs.define</span>
<span class="c1"># class ArangoReporter(TableReporter):</span>
<span class="c1">#     name: str = attrs.field(default=&quot;SQL&quot;)</span>


<span class="c1"># PLOT Reporters</span>
<div class="viewcode-block" id="DiskPlotReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.DiskPlotReporter.html#engforge.reporting.DiskPlotReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">DiskPlotReporter</span><span class="p">(</span><span class="n">PlotReporter</span><span class="p">,</span> <span class="n">DiskReporterMixin</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;DrivePlots&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">figkey</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">stored_plots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">figkey</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ensure_path</span><span class="p">(</span><span class="n">filname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;saving </span><span class="si">{</span><span class="n">figkey</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">filname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filname</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;issue showing </span><span class="si">{</span><span class="n">figkey</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    </div>


<div class="viewcode-block" id="GdriveReporter">
<a class="viewcode-back" href="../../_autosummary/engforge.reporting.GdriveReporter.html#engforge.reporting.GdriveReporter">[docs]</a>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">GdriveReporter</span><span class="p">(</span><span class="n">PlotReporter</span><span class="p">,</span> <span class="n">TemporalReporterMixin</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Gdrive&quot;</span><span class="p">)</span>
    <span class="n">share_drive</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="p">)</span></div>



<span class="c1"># TODO: move to analysis</span>
<span class="c1"># def split_dataframe_by_colmum(self,df,max_columns=10):</span>
<span class="c1">#     df_cols = list(df.columns)</span>
<span class="c1">#     if len(df_cols) &lt; max_columns:</span>
<span class="c1">#         return [df]</span>
<span class="c1">#</span>
<span class="c1">#     col_chunks = list(chunks(df_cols,max_columns))</span>
<span class="c1">#     dat_chunks = [df[colck].copy() for colck in col_chunks]</span>
<span class="c1">#</span>
<span class="c1">#     return dat_chunks</span>

<span class="c1"># def cleanup_dataframe(self,df,badwords=(&#39;min&#39;,&#39;max&#39;)):</span>
<span class="c1">#     tl_df = self.static_dataframe</span>
<span class="c1">#     to_drop = [cl for cl in tl_df.columns if any([bw in cl.lower() for bw in badwords])]</span>
<span class="c1">#     out_df = tl_df.drop(columns=to_drop)</span>
<span class="c1">#     return out_df</span>


<span class="c1"># @solver_cached</span>
<span class="c1"># def variable_dataframe(self):</span>
<span class="c1">#     vals = list(zip(*list((self.variable_data_dict.values()))))</span>
<span class="c1">#     cols = list((self.variable_data_dict.keys()))</span>
<span class="c1">#     if vals:</span>
<span class="c1">#         return pandas.DataFrame(data = vals, columns=cols, copy = True)</span>
<span class="c1">#     else:</span>
<span class="c1">#         return  None</span>
<span class="c1">#</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def static_dataframe(self):</span>
<span class="c1">#     vals = [list((self.static_data_dict.values()))]</span>
<span class="c1">#     cols = list((self.static_data_dict.keys()))</span>
<span class="c1">#     if vals:</span>
<span class="c1">#         return pandas.DataFrame(data = vals, columns=cols, copy = True)</span>
<span class="c1">#     else:</span>
<span class="c1">#         return None</span>

<span class="c1"># Clearance Methods</span>
<span class="c1"># table property internal variables</span>
<span class="c1"># __store_options = (&#39;csv&#39;,&#39;excel&#39;,&#39;gsheets&#39;)#,&#39;db&#39;,&#39;gsheets&#39;,&#39;excel&#39;,&#39;json&#39;)</span>
<span class="c1"># _store_types = None</span>
<span class="c1"># _store_level:int = -1</span>

<span class="c1">#     @property</span>
<span class="c1">#     def table_iterator(self):</span>
<span class="c1">#         &#39;&#39;&#39;Checks data to see what type of table it is, type 1 is a single row</span>
<span class="c1">#         whereas type 2 &amp; 3 have several rows, but type 2 has some values that are singular</span>
<span class="c1">#</span>
<span class="c1">#         iterates table_type,values,label&#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#         if not self.TABLE:</span>
<span class="c1">#             return 0,[],[]</span>
<span class="c1">#         if len(self.TABLE) &lt;= 1:</span>
<span class="c1">#             yield 1,self.TABLE[1],self.data_label</span>
<span class="c1">#         else:</span>
<span class="c1">#             #wide outerloop over vars</span>
<span class="c1">#             for label in set.union(*[set(tuple(row.keys())) for i,row in self.TABLE.items()]):</span>
<span class="c1">#                 #inner loop over data</span>
<span class="c1">#                 col = [row[label] if label in row else None for inx,row in self.TABLE.items()]</span>
<span class="c1">#</span>
<span class="c1">#                 if all([isinstance(cvar,TABLE_TYPES) for cvar in col]): #do a type check</span>
<span class="c1">#                     if len(set(col)) &lt;= 1: #All Values Are Similar</span>
<span class="c1">#                         yield 2, col[0], label #Can assume that first value is equal to all</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         yield 3, col, label</span>
<span class="c1">#</span>
<span class="c1"># def recursive_data_structure(self,levels_to_descend = -1, parent_level=0):</span>
<span class="c1">#     &#39;&#39;&#39;Returns the static and variable data from each configuration to grab defined by the</span>
<span class="c1">#     recursive commands input in this function</span>
<span class="c1">#</span>
<span class="c1">#     data is stored like: output[level]=[{static,variable},{static,variable},...]&#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#     output = {}</span>
<span class="c1">#</span>
<span class="c1">#     for level,conf in self.go_through_configurations(0,levels_to_descend,parent_level):</span>
<span class="c1">#         if level in output:</span>
<span class="c1">#             output[level].append({&#39;static&#39;:conf.static_dataframe,\</span>
<span class="c1">#                                     &#39;variable&#39;:conf.variable_dataframe,&#39;conf&#39;:conf})</span>
<span class="c1">#         else:</span>
<span class="c1">#             output[level] = [{&#39;static&#39;:conf.static_dataframe,\</span>
<span class="c1">#                                 &#39;variable&#39;:conf.variable_dataframe,\</span>
<span class="c1">#                                 &#39;conf&#39;:conf}]</span>
<span class="c1">#</span>
<span class="c1">#     return output</span>

<span class="c1"># Multi-Component Table Combination Methods</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def static_data_dict(self):</span>
<span class="c1">#     &#39;&#39;&#39;returns key-value pairs in table that are single valued, all in type 1, some in type 2&#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#     output = {}</span>
<span class="c1">#     for tab_type,value,label in self.table_iterator:</span>
<span class="c1">#         if tab_type == 1:</span>
<span class="c1">#             return {l:v for l,v in zip(label,value)}</span>
<span class="c1">#         elif tab_type == 2:</span>
<span class="c1">#             output[label] = value</span>
<span class="c1">#     return output</span>
<span class="c1">#</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def variable_data_dict(self):</span>
<span class="c1">#     &#39;&#39;&#39;returns a dictionary of key value pairs where values list is not the same all of type 3 and some of type 2&#39;&#39;&#39;</span>
<span class="c1">#     output = {}</span>
<span class="c1">#     for tab_type,value,label in self.table_iterator:</span>
<span class="c1">#         if tab_type == 3:</span>
<span class="c1">#             output[label] = value</span>
<span class="c1">#     return output</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># #Multi-Component Table Lookups</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def toplevel_static(self):</span>
<span class="c1">#     out_df = self.cleanup_dataframe( self.static_dataframe )</span>
<span class="c1">#     df_list = self.split_dataframe_by_colmum(out_df,self.max_col_width_static)</span>
<span class="c1">#</span>
<span class="c1">#     return {&#39;conf&#39;:self,&#39;dfs&#39;:  df_list }</span>
<span class="c1">#</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def other_static_tables(self):</span>
<span class="c1">#     rds = self.recursive_data_structure(self.store_level)</span>
<span class="c1">#     output = []</span>
<span class="c1">#     for index, components in rds.items():</span>
<span class="c1">#         if index &gt; 0:</span>
<span class="c1">#             for comp in components:</span>
<span class="c1">#                 if comp[&#39;static&#39;] is not None:</span>
<span class="c1">#                     df_list = self.split_dataframe_by_colmum(comp[&#39;static&#39;],self.max_col_width_static)</span>
<span class="c1">#                     output.append({&#39;conf&#39;:comp[&#39;conf&#39;],&#39;dfs&#39;: df_list})</span>
<span class="c1">#     return output</span>
<span class="c1">#</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def variable_tables(self):</span>
<span class="c1">#     &#39;&#39;&#39;Grabs all valid variable dataframes and puts them in a list&#39;&#39;&#39;</span>
<span class="c1">#     rds = self.recursive_data_structure(self.store_level)</span>
<span class="c1">#</span>
<span class="c1">#     output = []</span>
<span class="c1">#     for index, components in rds.items():</span>
<span class="c1">#         for comp in components:</span>
<span class="c1">#             if comp[&#39;variable&#39;] is not None:</span>
<span class="c1">#                 output.append({&#39;conf&#39;:comp[&#39;conf&#39;],&#39;df&#39;:comp[&#39;variable&#39;]})</span>
<span class="c1">#</span>
<span class="c1">#     return output</span>
<span class="c1">#</span>
<span class="c1"># @solver_cached</span>
<span class="c1"># def joined_dataframe(self):</span>
<span class="c1">#     &#39;&#39;&#39;this is a high level data frame with all data that changes in the system&#39;&#39;&#39;</span>
<span class="c1">#     if self.variable_tables:</span>
<span class="c1">#         return pandas.concat([ vt[&#39;df&#39;] for vt in list(reversed(self.variable_tables))],axis=1)</span>
<span class="c1">#     else:</span>
<span class="c1">#         return None</span>
<span class="c1">#</span>
<span class="c1"># @property</span>
<span class="c1"># def complete_dataframe(self):</span>
<span class="c1">#     &#39;&#39;&#39;this is a high level data frame with all data in the system&#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#     rds = self.recursive_data_structure()</span>
<span class="c1">#     if rds:</span>
<span class="c1">#         dataframes = []</span>
<span class="c1">#         stat_dataframes = []</span>
<span class="c1">#         for lvl, comps in rds.items():</span>
<span class="c1">#             for comp in comps:</span>
<span class="c1">#                 df = comp[&#39;conf&#39;].dataframe</span>
<span class="c1">#                 if not comp[&#39;conf&#39;] is self:</span>
<span class="c1">#                     nm = comp[&#39;conf&#39;].name.lower()</span>
<span class="c1">#                     if nm == &#39;default&#39;:</span>
<span class="c1">#                         nm = comp[&#39;conf&#39;].__class__.__name__.lower()</span>
<span class="c1">#                     nm = nm.replace(&#39; &#39;,&#39;_&#39;)</span>
<span class="c1">#                     strv=f&#39;{nm}_&#39;</span>
<span class="c1">#                     strv+=&#39;{}&#39;</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     nm = &#39;&#39;</span>
<span class="c1">#                     strv=&#39;{}&#39;</span>
<span class="c1">#                 df.rename(strv.format, axis=1, inplace=True)</span>
<span class="c1">#</span>
<span class="c1">#                 dataframes.append(df)</span>
<span class="c1">#         return pandas.concat(dataframes,join=&#39;outer&#39;,axis=1)</span>
<span class="c1">#</span>
<span class="c1">#     else:</span>
<span class="c1">#         return None</span>

<span class="c1"># Saving &amp; Data Acces Methods</span>
<span class="c1"># def get_field_from_table(self,field,check_type=None,check_value:Callable = None):</span>
<span class="c1">#     &#39;&#39;&#39;Converts Pandas To Numpy Array By Key, also handles poorly formated fields</span>
<span class="c1">#     :param check_type: use a type or tuple of types to validate if the field is of type table</span>
<span class="c1">#     :param check_value: use a function to check each value to ensure its valid for return, check type take priority&#39;&#39;&#39;</span>
<span class="c1">#     if self.joined_dataframe is None:</span>
<span class="c1">#         return numpy.array([])</span>
<span class="c1">#     elif field in self.joined_dataframe:</span>
<span class="c1">#         table = self.joined_dataframe[field]</span>
<span class="c1">#     elif field.title() in self.joined_dataframe:</span>
<span class="c1">#         table = self.joined_dataframe[field.title()]</span>
<span class="c1">#     else:</span>
<span class="c1">#         raise Exception(&#39;No Field Named {}&#39;.format(field))</span>
<span class="c1">#</span>
<span class="c1">#     #Remove Infinity</span>
<span class="c1">#     table = table.replace([numpy.inf, -numpy.inf], numpy.nan)</span>
<span class="c1">#</span>
<span class="c1">#     if check_type is not None:</span>
<span class="c1">#         if all([isinstance(v,check_type) for v in table]):</span>
<span class="c1">#             return table.to_numpy(copy=True)</span>
<span class="c1">#         return None</span>
<span class="c1">#     elif check_value is not None:</span>
<span class="c1">#         if all([check_value(v) for v in table]):</span>
<span class="c1">#             return table.to_numpy(copy=True)</span>
<span class="c1">#         return None</span>
<span class="c1">#</span>
<span class="c1">#     return table.to_numpy(dtype=float,copy=True)</span>


<span class="c1"># Save functionality</span>
<span class="c1"># TODO: get me outta hur</span>
<span class="c1">#     def save_table(self,dataframe=None,filename=None,meta_tags=None,*args,**kwargs):</span>
<span class="c1">#         &#39;&#39;&#39;Header method to save the config in many different formats</span>
<span class="c1">#         :param meta_tags: a dictionary with headers being column names, and the value as the item to fill that column&#39;&#39;&#39;</span>
<span class="c1">#         if dataframe is None:</span>
<span class="c1">#             dataframe = self.dataframe</span>
<span class="c1">#</span>
<span class="c1">#         self.info(&#39;saving gsheets...&#39;)</span>
<span class="c1">#</span>
<span class="c1">#         if meta_tags is not None and type(meta_tags) is dict:</span>
<span class="c1">#             for tag,value in meta_tags.items():</span>
<span class="c1">#                 dataframe[tag] = value</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#         for save_format in self.store_types:</span>
<span class="c1">#             try:</span>
<span class="c1">#                 if save_format == &#39;csv&#39;:</span>
<span class="c1">#                     self.save_csv(dataframe,filename,*args,**kwargs)</span>
<span class="c1">#                 elif save_format == &#39;excel&#39;:</span>
<span class="c1">#                     self.save_excel(dataframe,filename,*args,**kwargs)</span>
<span class="c1">#                 elif save_format == &#39;gsheets&#39;:</span>
<span class="c1">#                     self.save_gsheets(dataframe,filename,*args,**kwargs)</span>
<span class="c1">#             except Exception as e:</span>
<span class="c1">#                 self.error(e,&#39;Issue Saving Tables:&#39;)</span>

<span class="c1">#     def save_csv(self,dataframe,filename=None,*args,**kwargs):</span>
<span class="c1">#         if self.TABLE:</span>
<span class="c1">#             if filename is None:</span>
<span class="c1">#                 filename = &#39;{}.csv&#39;.format(self.filename)</span>
<span class="c1">#             if type(filename) is str and not filename.endswith(&#39;.csv&#39;):</span>
<span class="c1">#                 filename += &#39;.csv&#39;</span>
<span class="c1">#             filepath = os.path.join(self.config_path_daily,filename)</span>
<span class="c1">#             dataframe.to_csv(path_or_buf=filepath,index=False,*args,**kwargs)</span>
<span class="c1">#</span>
<span class="c1">#     def save_excel(self,dataframe,filename=None,*args,**kwargs):</span>
<span class="c1">#         if self.TABLE:</span>
<span class="c1">#             if filename is None:</span>
<span class="c1">#                 filename = &#39;{}.xlsx&#39;.format(self.filename)</span>
<span class="c1">#             if type(filename) is str and not filename.endswith(&#39;.xlsx&#39;):</span>
<span class="c1">#                 filename += &#39;.xlsx&#39;</span>
<span class="c1">#             filepath = os.path.join(self.config_path_daily,filename)</span>
<span class="c1">#             dataframe.to_excel(path_or_buf=filepath,*args,**kwargs)</span>

<span class="c1">#     @property</span>
<span class="c1">#     def store_level(self):</span>
<span class="c1">#         return self._store_level</span>
<span class="c1">#</span>
<span class="c1">#     @store_level.setter</span>
<span class="c1">#     def store_level(self,new_level:int):</span>
<span class="c1">#         assert isinstance(new_level,(int))</span>
<span class="c1">#         self._store_level = new_level</span>
<span class="c1">#</span>
<span class="c1">#     @property</span>
<span class="c1">#     def store_types(self):</span>
<span class="c1">#         if self._store_types is None:</span>
<span class="c1">#             self._store_types = [] #initalization</span>
<span class="c1">#         return self._store_types</span>

<span class="c1">#     @store_types.setter</span>
<span class="c1">#     def store_types(self, new_type_or_list):</span>
<span class="c1">#         &#39;&#39;&#39;If you add a list or iterable, and each value is a valid output option we will assign it</span>
<span class="c1">#         otherwise if its a value in the valid options it will be added.</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         if isinstance(new_type_or_list,(list,tuple)):</span>
<span class="c1">#             assert all([val in self.__store_options for val in new_type_or_list])</span>
<span class="c1">#             self._store_types = list(new_type_or_list)</span>
<span class="c1">#</span>
<span class="c1">#         elif new_type_or_list in self.__store_options:</span>
<span class="c1">#              self._store_types.append(new_type_or_list)</span>
<span class="c1">#</span>
<span class="c1">#         else:</span>
<span class="c1">#             self.warning(&#39;store types input not valid {}&#39;.format(new_type_or_list))</span>


<span class="c1">#     def save_to_worksheet(self,worksheet:&#39;pygsheets.Worksheet&#39;):</span>
<span class="c1">#         &#39;&#39;&#39;Saves to a gsheets via pygsheets adds static and regular data&#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#         title = self.identity.replace(&#39;_&#39;,&#39; &#39;).title()</span>
<span class="c1">#</span>
<span class="c1">#         self.info(&#39;saving worksheet as {}&#39;.format(title))</span>
<span class="c1">#         wksh = worksheet</span>
<span class="c1">#</span>
<span class="c1">#         wksh.clear()</span>
<span class="c1">#</span>
<span class="c1">#         #Static data</span>
<span class="c1">#         start = pygsheets.Address((2,2))</span>
<span class="c1">#</span>
<span class="c1">#         tld = self.toplevel_static</span>
<span class="c1">#         sdf = tld[&#39;dfs&#39;]</span>
<span class="c1">#</span>
<span class="c1">#         cur_index = start + (1,0)</span>
<span class="c1">#         for i,df in enumerate(sdf):</span>
<span class="c1">#             self.debug(&#39;saving dataframe {}&#39;.format(df))</span>
<span class="c1">#             wksh.update_value(start.label,self.identity)</span>
<span class="c1">#             wksh.cell(start.label).set_text_format(&#39;bold&#39;,True)</span>
<span class="c1">#             wksh.set_dataframe(df,cur_index.label , extend=True)</span>
<span class="c1">#             cur_index += (2,0)</span>
<span class="c1">#</span>
<span class="c1">#         cur_index += (3,0)</span>
<span class="c1">#</span>
<span class="c1">#         var_index = pygsheets.Address(cur_index.label)</span>
<span class="c1">#</span>
<span class="c1">#         max_row = 0</span>
<span class="c1">#</span>
<span class="c1">#         vrt = self.variable_tables</span>
<span class="c1">#         self.info(&#39;saving {} other static tables&#39;.format(len(vrt)))</span>
<span class="c1">#</span>
<span class="c1">#         for dfpack in vrt:</span>
<span class="c1">#             conf = dfpack[&#39;conf&#39;]</span>
<span class="c1">#             df = dfpack[&#39;df&#39;]</span>
<span class="c1">#             self.debug(&#39;saving dataframe {}&#39;.format(df))</span>
<span class="c1">#</span>
<span class="c1">#             (num_rows,num_cols) = df.shape</span>
<span class="c1">#             max_row = max(max_row,num_rows)</span>
<span class="c1">#</span>
<span class="c1">#             wksh.update_value((var_index-(1,0)).label,conf.classname)</span>
<span class="c1">#             wksh.cell((var_index-(1,0)).label).set_text_format(&#39;bold&#39;,True)</span>
<span class="c1">#</span>
<span class="c1">#             wksh.set_dataframe(df,start=var_index.label,extend=True)</span>
<span class="c1">#</span>
<span class="c1">#             var_index += (0,num_cols)</span>
<span class="c1">#</span>
<span class="c1">#         cur_index += (3+max_row,0)</span>
<span class="c1">#</span>
<span class="c1">#         ost = self.other_static_tables</span>
<span class="c1">#</span>
<span class="c1">#         self.info(&#39;saving {} other static tables&#39;.format(len(ost)))</span>
<span class="c1">#</span>
<span class="c1">#         for dfpack in ost:</span>
<span class="c1">#             conf = dfpack[&#39;conf&#39;]</span>
<span class="c1">#             sdf = dfpack[&#39;dfs&#39;]</span>
<span class="c1">#</span>
<span class="c1">#             wksh.update_value((cur_index-(1,0)).label,conf.identity)</span>
<span class="c1">#             wksh.cell((cur_index-(1,0)).label).set_text_format(&#39;bold&#39;,True)</span>
<span class="c1">#</span>
<span class="c1">#             for i,df in enumerate(sdf):</span>
<span class="c1">#</span>
<span class="c1">#                 self.debug(&#39;saving {} dataframe {}&#39;.format(conf.identity, df))</span>
<span class="c1">#                 wksh.set_dataframe(df,start=cur_index.label ,extend=True)</span>
<span class="c1">#                 cur_index += (2,0)</span>
<span class="c1">#</span>
<span class="c1">#             cur_index += (3,0)</span>


<span class="c1">#     def save_gsheets(self,dataframe,filename=None,index=False,*args,**kwargs):</span>
<span class="c1">#         &#39;&#39;&#39;A function to save the table to google sheets</span>
<span class="c1">#         :param filename: the filepath on google drive - be careful!</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         with self.drive.context(filepath_root=self.local_sync_path, sync_root=self.cloud_sync_path) as gdrive:</span>
<span class="c1">#             with gdrive.rate_limit_manager( self.save_gsheets,6,dataframe,filename=filename,*args,**kwargs) as tdrive:</span>
<span class="c1">#</span>
<span class="c1">#                 old_sleep = tdrive._sleep_time</span>
<span class="c1">#                 tdrive.reset_sleep_time( max(old_sleep,2.5) )</span>
<span class="c1">#</span>
<span class="c1">#                 gpath = tdrive.sync_path(self.local_sync_path)</span>
<span class="c1">#                 self.info(f&#39;saving as gsheets in dir {self.local_sync_path} -&gt; {gpath}&#39;)</span>
<span class="c1">#                 parent_id = gdrive.get_gpath_id(gpath)</span>
<span class="c1">#                 #TODO: delete old file if exists</span>
<span class="c1">#                 tdrive.sleep(2*(1+tdrive.time_fuzz*random.random()))</span>
<span class="c1">#                 if tdrive and tdrive.gsheets:</span>
<span class="c1">#                     sht = tdrive.gsheets.create(filename,folder=parent_id)</span>
<span class="c1">#</span>
<span class="c1">#                     tdrive.sleep(2*(1+tdrive.time_fuzz*random.random()))</span>
<span class="c1">#                     tdrive.cache_directory(parent_id)</span>
<span class="c1">#</span>
<span class="c1">#                     wk = sht.sheet1</span>
<span class="c1">#</span>
<span class="c1">#                     wk.rows = dataframe.shape[0]</span>
<span class="c1">#                     gdrive.sleep(2*(1+tdrive.time_fuzz*random.random()))</span>
<span class="c1">#</span>
<span class="c1">#                     wk.set_dataframe(dataframe,start=&#39;A1&#39;,fit=True)</span>
<span class="c1">#                     gdrive.sleep(2*(1+tdrive.time_fuzz*random.random()))</span>
<span class="c1">#</span>
<span class="c1">#                     #TODO: add in dataframe dict with schema sheename: {dataframe,**other_args}</span>
<span class="c1">#                     self.info(&#39;gsheet saved -&gt; {}&#39;.format(os.path.join(gpath,filename)))</span>
<span class="c1">#</span>
<span class="c1">#                 tdrive.reset_sleep_time( old_sleep )</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin Russell.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>